<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <base href="/">
  
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">
  
  <!-- 强制使用HTML渲染器，避免CanvasKit的7MB下载 -->
  <meta name="flutter-web-renderer" content="html">
  
  <!-- 🚀 性能优化：资源预加载 -->
  <link rel="preload" href="/main.dart.js" as="script">
  <link rel="preload" href="/main.dart.js_1.part.js" as="script">
  <link rel="preload" href="/main.dart.js_2.part.js" as="script">
  <link rel="preload" href="/flutter.js" as="script">
  <link rel="preload" href="/flutter_bootstrap.js" as="script">
  <!-- 预加载中文与英文字体，减少首屏字体闪烁（FOUT/FOIT） -->
  <link rel="preload" href="assets/fonts/NotoSansSC-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="assets/fonts/NotoSansSC-Bold.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="assets/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin>
  
  <!-- 🌐 CDN 预连接 -->
  <link rel="preconnect" href="https://maliangwriter.com">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- 📱 移动端优化 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="ainoval">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>ainoval</title>
  <link rel="manifest" href="manifest.json">
  
  <style>
    /* 字体声明：使用 font-display: swap 避免因字体加载导致的文字不可见 */
    @font-face {
      font-family: 'Noto Sans SC';
      src: url('assets/fonts/NotoSansSC-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Noto Sans SC';
      src: url('assets/fonts/NotoSansSC-Bold.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Roboto';
      src: url('assets/fonts/Roboto-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    /* 🎨 关键CSS内联，减少渲染阻塞 */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans SC', 'PingFang SC', 'Microsoft YaHei', 'Hiragino Sans GB', 'Heiti SC', 'WenQuanYi Micro Hei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans CJK SC', 'Source Han Sans SC', 'Source Han Sans CN', 'Droid Sans Fallback', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
      background: #ffffff;
      min-height: 100vh;
      overflow: hidden;
    }
    
    /* ✨ 加载容器 */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      background: #ffffff;
    }
    
    /* ☯️ 阴阳太极背景图案 */
    .background-pattern {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.015;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(0, 0, 0, 0.1) 0%, transparent 60%),
        radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.1) 0%, transparent 60%),
        radial-gradient(circle at 60% 20%, rgba(0, 0, 0, 0.05) 0%, transparent 70%),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
      background-size: 800px 800px, 600px 600px, 900px 900px, 700px 700px;
      background-position: 0 0, 150px 150px, 300px 80px, 80px 300px;
      animation: taichiFloat 30s ease-in-out infinite;
    }
    
    .background-dots {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      opacity: 0.03;
      background-image: 
        radial-gradient(circle, rgba(0, 0, 0, 0.1) 1px, transparent 1px),
        radial-gradient(circle, rgba(128, 128, 128, 0.05) 0.5px, transparent 0.5px);
      background-size: 80px 80px, 40px 40px;
      background-position: 0 0, 20px 20px;
      animation: inkDotFloat 20s ease-in-out infinite;
    }
    
    /* 🎯 主要内容容器 */
    .loading-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeInUp 0.8s ease-out;
      z-index: 10;
    }
    
    /* 🖋️ 神笔马良图标 */
    .fresh-icon {
      width: 140px;
      height: 140px;
      margin-bottom: 30px;
      animation: breathe 4s ease-in-out infinite;
    }
    
    .fresh-icon svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 8px 32px rgba(0, 0, 0, 0.2));
    }
    
    /* 📝 应用标题 */
    .app-title {
      font-size: 32px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 12px;
      letter-spacing: -0.5px;
    }
    
    /* 💭 副标题 */
    .app-subtitle {
      font-size: 16px;
      color: #718096;
      margin-bottom: 50px;
      font-weight: 400;
    }
    
    /* 📊 进度条容器 */
    .progress-container {
      width: 320px;
      height: 6px;
      background: rgba(226, 232, 240, 0.8);
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 24px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
    }
    
    /* 📈 进度条 */
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #2C2C2C, #000000, #4A4A4A);
      border-radius: 20px;
      width: 0%;
      animation: progressFlow 3s ease-in-out infinite;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      position: relative;
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.6) 50%, 
        transparent 100%);
      animation: shine 2s ease-in-out infinite;
    }
    
    /* 💬 加载文本 */
    .loading-text {
      color: #4a5568;
      font-size: 14px;
      font-weight: 500;
      animation: textPulse 2s ease-in-out infinite;
    }
    
    /* 🎪 动画关键帧 */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes breathe {
      0%, 100% {
        transform: scale(1);
        filter: drop-shadow(0 8px 32px rgba(0, 0, 0, 0.2));
      }
      50% {
        transform: scale(1.05);
        filter: drop-shadow(0 12px 48px rgba(0, 0, 0, 0.4));
      }
    }
    
    @keyframes progressFlow {
      0% {
        width: 0%;
      }
      50% {
        width: 75%;
      }
      100% {
        width: 100%;
      }
    }
    
    @keyframes shine {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100%);
      }
    }
    
    @keyframes textPulse {
      0%, 100% {
        opacity: 0.6;
      }
      50% {
        opacity: 1;
      }
    }
    
    @keyframes taichiFloat {
      0%, 100% {
        transform: translateY(0px) rotate(0deg);
      }
      25% {
        transform: translateY(-15px) rotate(90deg);
      }
      50% {
        transform: translateY(0px) rotate(180deg);
      }
      75% {
        transform: translateY(15px) rotate(270deg);
      }
    }
    
    @keyframes inkDotFloat {
      0%, 100% {
        transform: translate(0px, 0px);
      }
      25% {
        transform: translate(-10px, -5px);
      }
      50% {
        transform: translate(15px, -8px);
      }
      75% {
        transform: translate(-5px, 12px);
      }
    }
    
    /* 📱 响应式设计 */
    @media (max-width: 480px) {
      .fresh-icon {
        width: 120px;
        height: 120px;
      }
      
      .app-title {
        font-size: 28px;
      }
      
      .app-subtitle {
        font-size: 14px;
      }
      
      .progress-container {
        width: 280px;
      }
    }
  </style>
</head>
<body>
  <!-- ✨ 清新加载界面 -->
  <div id="loading" class="loading">
    <!-- 🌿 清新背景图案 -->
    <div class="background-pattern"></div>
    <div class="background-dots"></div>
    
    <!-- 🎯 主要内容 -->
    <div class="loading-content">
      <!-- ☯️ 阴阳神笔图标 -->
      <div class="fresh-icon">
        <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- 太极阴阳底盘 -->
          <g transform="translate(50, 50)">
            <!-- 外圈太极旋转 -->
            <g class="taichi-container">
              <!-- 阴阳主体 -->
              <path d="M-30,0 A30,30 0 0,1 30,0 A15,15 0 0,1 0,0 A15,15 0 0,0 -30,0Z" 
                    fill="#000000" opacity="0.4">
                <animateTransform attributeName="transform" type="rotate" 
                  values="0;360" dur="20s" repeatCount="indefinite"/>
              </path>
              
              <path d="M30,0 A30,30 0 0,1 -30,0 A15,15 0 0,1 0,0 A15,15 0 0,0 30,0Z" 
                    fill="#ffffff" opacity="0.6" stroke="#000000" stroke-width="0.3">
                <animateTransform attributeName="transform" type="rotate" 
                  values="0;360" dur="20s" repeatCount="indefinite"/>
              </path>
              
              <!-- 阴眼 -->
              <circle cx="0" cy="-15" r="3" fill="#ffffff" opacity="0.7">
                <animateTransform attributeName="transform" type="rotate" 
                  values="0;360" dur="20s" repeatCount="indefinite"/>
              </circle>
              
              <!-- 阳眼 -->
              <circle cx="0" cy="15" r="3" fill="#000000" opacity="0.8">
                <animateTransform attributeName="transform" type="rotate" 
                  values="0;360" dur="20s" repeatCount="indefinite"/>
              </circle>
            </g>
            
            <!-- 外圈边框 -->
            <circle cx="0" cy="0" r="32" fill="none" stroke="url(#borderGradient)" 
                    stroke-width="1" opacity="0.3">
              <animate attributeName="stroke-width" values="0.8;1.2;0.8" dur="4s" repeatCount="indefinite"/>
            </circle>
          </g>
          
          <!-- 中央神笔 -->
          <g transform="translate(50, 50)">
            <!-- 笔杆阴影 -->
            <rect x="-2.5" y="-24" width="5" height="35" rx="2.5" fill="rgba(0,0,0,0.3)" 
                  transform="translate(1, 1)">
              <animate attributeName="opacity" values="0.2;0.4;0.2" dur="6s" repeatCount="indefinite"/>
              <animateTransform attributeName="transform" type="rotate" 
                values="0;3;-1;0" dur="8s" repeatCount="indefinite"/>
            </rect>
            
            <!-- 笔杆发光外轮廓 -->
            <rect x="-3" y="-24.5" width="6" height="36" rx="3" fill="none" 
                  stroke="rgba(255,255,255,0.6)" stroke-width="0.8" opacity="0.5">
              <animate attributeName="opacity" values="0.3;0.7;0.3" dur="6s" repeatCount="indefinite"/>
              <animate attributeName="stroke-width" values="0.6;1;0.6" dur="6s" repeatCount="indefinite"/>
              <animateTransform attributeName="transform" type="rotate" 
                values="0;3;-1;0" dur="8s" repeatCount="indefinite"/>
            </rect>
            
            <!-- 笔杆主体 -->
            <rect x="-2.5" y="-24" width="5" height="35" rx="2.5" fill="url(#inkBrushHandle)" 
                  stroke="rgba(255,255,255,0.4)" stroke-width="0.8">
              <animate attributeName="opacity" values="0.95;1;0.95" dur="6s" repeatCount="indefinite"/>
              <animateTransform attributeName="transform" type="rotate" 
                values="0;3;-1;0" dur="8s" repeatCount="indefinite"/>
            </rect>
            
            <!-- 笔头金属环 -->
            <rect x="-2" y="10" width="4" height="4" fill="url(#metalRingGradient)" rx="0.5">
              <animate attributeName="opacity" values="0.8;1;0.8" dur="6s" repeatCount="indefinite"/>
            </rect>
            
            <!-- 笔毛主体 -->
            <ellipse cx="0" cy="16" rx="1.8" ry="5" fill="url(#brushTipGradient)" 
                     stroke="rgba(255,255,255,0.2)" stroke-width="0.3">
              <animate attributeName="opacity" values="0.9;1;0.9" dur="6s" repeatCount="indefinite"/>
            </ellipse>
            
            <!-- 笔毛尖端 -->
            <ellipse cx="0" cy="20" rx="0.8" ry="2" fill="#000000">
              <animate attributeName="opacity" values="0.8;1;0.8" dur="6s" repeatCount="indefinite"/>
            </ellipse>
          </g>
          
          <!-- 墨滴环绕效果 -->
          <g>
            <circle cx="25" cy="30" r="1" fill="#000000" opacity="0.4">
              <animate attributeName="cy" values="25;35;25" dur="4s" repeatCount="indefinite"/>
              <animate attributeName="opacity" values="0;0.6;0" dur="4s" repeatCount="indefinite"/>
            </circle>
            <circle cx="75" cy="40" r="1.2" fill="#000000" opacity="0.5">
              <animate attributeName="cy" values="35;45;35" dur="5s" repeatCount="indefinite" begin="1s"/>
              <animate attributeName="opacity" values="0;0.7;0" dur="5s" repeatCount="indefinite" begin="1s"/>
            </circle>
            <circle cx="30" cy="75" r="0.8" fill="#000000" opacity="0.3">
              <animate attributeName="cy" values="70;80;70" dur="3.5s" repeatCount="indefinite" begin="2s"/>
              <animate attributeName="opacity" values="0;0.5;0" dur="3.5s" repeatCount="indefinite" begin="2s"/>
            </circle>
          </g>
          
          <!-- 飘散的笔墨气韵 -->
          <g opacity="0.6">
            <!-- 墨迹1 -->
            <path d="M20 25 Q15 20 22 18 Q28 22 20 25" fill="url(#inkCloudGradient)">
              <animateTransform attributeName="transform" type="translate" 
                values="0,0; -8,-12; -15,-20; -10,-25" dur="12s" repeatCount="indefinite"/>
              <animate attributeName="opacity" values="0;0.6;0.3;0" dur="12s" repeatCount="indefinite"/>
            </path>
            
            <!-- 墨迹2 -->
            <path d="M80 35 Q75 30 82 28 Q88 32 80 35" fill="url(#inkCloudGradient2)">
              <animateTransform attributeName="transform" type="translate" 
                values="0,0; 10,-15; 18,-25; 12,-30" dur="10s" repeatCount="indefinite" begin="2s"/>
              <animate attributeName="opacity" values="0;0.5;0.2;0" dur="10s" repeatCount="indefinite" begin="2s"/>
            </path>
            
            <!-- 墨迹3 -->
            <path d="M25 70 Q20 65 27 63 Q33 67 25 70" fill="url(#inkCloudGradient)">
              <animateTransform attributeName="transform" type="translate" 
                values="0,0; -6,-10; -12,-18; -8,-22" dur="14s" repeatCount="indefinite" begin="1s"/>
              <animate attributeName="opacity" values="0;0.4;0.2;0" dur="14s" repeatCount="indefinite" begin="1s"/>
            </path>
          </g>
          
          <!-- 渐变定义 -->
          <defs>
            <!-- 边框渐变 -->
            <linearGradient id="borderGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#000000"/>
              <stop offset="50%" style="stop-color:#666666"/>
              <stop offset="100%" style="stop-color:#ffffff"/>
            </linearGradient>
            
            <!-- 墨色笔杆渐变 -->
            <linearGradient id="inkBrushHandle" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#666666"/>
              <stop offset="20%" style="stop-color:#404040"/>
              <stop offset="50%" style="stop-color:#1A1A1A"/>
              <stop offset="80%" style="stop-color:#000000"/>
              <stop offset="100%" style="stop-color:#2C2C2C"/>
            </linearGradient>
            
            <!-- 笔头渐变 -->
            <linearGradient id="brushTipGradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#4A4A4A"/>
              <stop offset="50%" style="stop-color:#1A1A1A"/>
              <stop offset="100%" style="stop-color:#000000"/>
            </linearGradient>
            
            <!-- 金属环渐变 -->
            <linearGradient id="metalRingGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#C0C0C0"/>
              <stop offset="30%" style="stop-color:#808080"/>
              <stop offset="70%" style="stop-color:#404040"/>
              <stop offset="100%" style="stop-color:#202020"/>
            </linearGradient>
            
            <!-- 墨云渐变1 -->
            <radialGradient id="inkCloudGradient" cx="50%" cy="50%" r="50%">
              <stop offset="0%" style="stop-color:rgba(0, 0, 0, 0.6)"/>
              <stop offset="70%" style="stop-color:rgba(102, 102, 102, 0.3)"/>
              <stop offset="100%" style="stop-color:rgba(0, 0, 0, 0.1)"/>
            </radialGradient>
            
            <!-- 墨云渐变2 -->
            <radialGradient id="inkCloudGradient2" cx="50%" cy="50%" r="50%">
              <stop offset="0%" style="stop-color:rgba(26, 26, 26, 0.7)"/>
              <stop offset="60%" style="stop-color:rgba(76, 76, 76, 0.4)"/>
              <stop offset="100%" style="stop-color:rgba(255, 255, 255, 0.1)"/>
            </radialGradient>
          </defs>
        </svg>
      </div>
      
      <!-- 📝 应用信息 -->
      <h1 class="app-title">马良 AI 小说助手</h1>
      <p class="app-subtitle">神笔在手，妙笔生花</p>
      
      <!-- 📊 进度条 -->
      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      
      <!-- 💬 状态文本 -->
      <p class="loading-text" id="loadingText">正在启动创作之旅...</p>
    </div>
  </div>
  
  <script>
    // 🚀 性能监控
    window.performance.mark('app-start');
    
    // ☯️ 增强阴阳太极背景动画
    function enhanceTaichiPattern() {
      const pattern = document.querySelector('.background-pattern');
      const dots = document.querySelector('.background-dots');
      
      if (pattern) {
        // 太极图案缓慢旋转和位移
        let rotation = 0;
        setInterval(() => {
          rotation += 0.5;
          const offsetX = Math.sin(rotation * Math.PI / 180) * 5;
          const offsetY = Math.cos(rotation * Math.PI / 180) * 3;
          pattern.style.transform = `translate(${offsetX}px, ${offsetY}px) rotate(${rotation * 0.1}deg)`;
        }, 100);
      }
      
      if (dots) {
        // 墨点图案反向缓慢移动
        let dotRotation = 0;
        setInterval(() => {
          dotRotation -= 0.2;
          const offsetX = Math.cos(dotRotation * Math.PI / 180) * 3;
          const offsetY = Math.sin(dotRotation * Math.PI / 180) * 2;
          dots.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
        }, 150);
      }
    }
    
    // 📈 模拟进度条进度
    function simulateProgress() {
      const progressBar = document.getElementById('progressBar');
      const loadingText = document.getElementById('loadingText');
      let progress = 0;
      
      const loadingSteps = [
        '正在准备写作环境...',
        '正在初始化智能助手...',
        '正在连接创作云端...',
        '正在整理创作工具...',
        '马上就好...'
      ];
      
      const progressInterval = setInterval(() => {
        progress += Math.random() * 15 + 5;
        if (progress > 95) progress = 95;
        
        progressBar.style.width = progress + '%';
        
        // 更新加载文本
        const stepIndex = Math.floor((progress / 100) * loadingSteps.length);
        if (stepIndex < loadingSteps.length) {
          loadingText.textContent = loadingSteps[stepIndex];
        }
        
        if (progress >= 95) {
          clearInterval(progressInterval);
        }
      }, 200);
      
      return progressInterval;
    }
    
    // 🎯 页面加载完成后的初始化
    document.addEventListener('DOMContentLoaded', function() {
      enhanceTaichiPattern();
      const progressInterval = simulateProgress();
      
      // ✨ 隐藏加载指示器
      window.addEventListener('flutter-first-frame', function() {
        const progressBar = document.getElementById('progressBar');
        const loadingText = document.getElementById('loadingText');
        
        // 完成进度条
        progressBar.style.width = '100%';
        loadingText.textContent = '加载完成！';
        
        // 延迟隐藏加载界面，给用户完整的体验
        setTimeout(() => {
          const loading = document.getElementById('loading');
          loading.style.opacity = '0';
          loading.style.transition = 'opacity 0.5s ease-out';
          
          setTimeout(() => {
            loading.style.display = 'none';
          }, 500);
        }, 800);
        
        // 性能监控
        window.performance.mark('app-ready');
        window.performance.measure('app-boot', 'app-start', 'app-ready');
        console.log('🚀 App boot time:', window.performance.getEntriesByName('app-boot')[0].duration + 'ms');
        
        clearInterval(progressInterval);
      });
    });
    
    // ⏱️ 超时备用方案
    setTimeout(function() {
      const loading = document.getElementById('loading');
      if (loading && loading.style.display !== 'none') {
        // 如果超时，也要给一个优雅的退出
        loading.style.opacity = '0';
        loading.style.transition = 'opacity 0.5s ease-out';
        setTimeout(() => {
          loading.style.display = 'none';
        }, 500);
        console.warn('⚠️ Loading timeout - hiding loading screen');
      }
    }, 12000);
  </script>
  
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
